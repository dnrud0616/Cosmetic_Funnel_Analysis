# -*- coding: utf-8 -*-
"""í™ìš°ê²½_ì˜¨ë¼ì¸ í™”ì¥í’ˆ Funnel ë¶„ì„.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1wLTlEH5CuPlB3XsTjVielM2nrueS4HGc

**ì˜¨ë¼ì¸ í™”ì¥í’ˆ Funnelë¶„ì„**
---
> **ëª©ì°¨(Context)**

* í”„ë¡œì íŠ¸ Summary
* ë¬¸ì œìƒí™© Introduction

## **í”„ë¡œì íŠ¸ Summary**
---

> **í”„ë¡œì íŠ¸ëª…**

```
â–¶ ì˜¨ë¼ì¸ í™”ì¥í’ˆ Funnelë¶„ì„
```  

> **í”„ë¡œì íŠ¸ìœ í˜•**

```
â–¶ ì˜¨ë¼ì¸ í™”ì¥í’ˆ êµ¬ë§¤ì´ë ¥ ë°ì´í„° í™œìš© Funnel ë¶„ì„

```

> **í•™ìŠµëª©í‘œ**

```
â–¶ ì˜¨ë¼ì¸ í™”ì¥í’ˆ êµ¬ë§¤ ê³¼ì •ì—ì„œì˜ ì‚¬ìš©ì í–‰ë™ íŒ¨í„´ ì¸ì‹
â–¶ Funnel ë‹¨ê³„ë³„ dropout ì§€ì  ë° ì´ìœ  íŒŒì•…
â–¶ íš¨ê³¼ì ì¸ ë§ˆì¼€íŒ… ë° ê°œì„  ì „ëµ ì œì•ˆì„ ìœ„í•œ ë°ì´í„° ë¶„ì„ ëŠ¥ë ¥ í–¥ìƒ
```

> **ì˜ˆìƒ ê²°ê³¼ë¬¼**

```
â–¶ Funnel ë¶„ì„ ë¦¬í¬íŠ¸ (ê° ë‹¨ê³„ë³„ ì´íƒˆë¥ , ì£¼ìš” ì´íƒˆ ì›ì¸ ë“±)
â–¶ í™”ì¥í’ˆ êµ¬ë§¤ ì „í™˜ë¥  ê°œì„ ì„ ìœ„í•œ ì „ëµ ë° ì œì•ˆì„œ
â–¶ ë°ì´í„° ì‹œê°í™” ëŒ€ì‹œë³´ë“œ (ì˜ˆ: Tableau, Power BI ë“±ì„ ì‚¬ìš©í•œ ëŒ€ì‹œë³´ë“œ)
```

> **ë°ì´í„° ì‚´í´ë³´ê¸°**


|Column|Description|
|:---|:---|
|event_time|ì´ë²¤íŠ¸ê°€ ë°œìƒí•œ ì‹œê°„|
|event_type|ì´ë²¤íŠ¸ ìœ í˜•: [view, cart, remove_from_cart, purchase] ì¤‘ í•˜ë‚˜|
|product_id|ì œí’ˆ ID|
|category_id|ì œí’ˆ ì¹´í…Œê³ ë¦¬ ID|
|category_code|ì˜ë¯¸ ìˆëŠ” ì¹´í…Œê³ ë¦¬ ì´ë¦„ (ìˆëŠ” ê²½ìš°)|
|brand|ë¸Œëœë“œ ì´ë¦„ (ì†Œë¬¸ìë¡œ, ìˆì„ ê²½ìš°)|
|price|ì œí’ˆ ê°€ê²©|
|user_id|ì˜êµ¬ ì‚¬ìš©ì ID|
|user_session|ì‚¬ìš©ì ì„¸ì…˜ ID|
"""

# â–¶ Warnings ì œê±°
import warnings
warnings.filterwarnings('ignore')

# â–¶ Google drive mount or í´ë” í´ë¦­ í›„ êµ¬ê¸€ë“œë¼ì´ë¸Œ ì—°ê²°
from google.colab import drive
drive.mount('/content/drive')

# â–¶ ê²½ë¡œ ì„¤ì • (â€»ê°•ì˜ìë£Œê°€ ìœ„ì¹˜ì— ìˆëŠ” ê²½ë¡œ í™•ì¸)
import os
os.chdir('/content/drive/MyDrive/DA7/á„€á…¢á„‹á…µá†«á„‘á…³á„…á…©á„Œá…¦á†¨á„á…³/á„Œá…¦á„á…®á†¯á„‹á…ªá†«á„…á…­/02(11)á„’á…ªá„Œá…¡á†¼á„‘á…®á†·(á„Œá…®á†¼)')
os.getcwd()

# â–¶ Data read
import pandas as pd
df = pd.read_csv('P_PJT11_DATA.csv')
df.head()

"""## **ğŸ”ˆProcess01**  
**â”— Data Info Check**  
---

### Â· Data ì „ì²˜ë¦¬  
---
* ìˆ˜ì§‘ëœ ë°ì´í„°ì˜ ê¸°ë³¸ ì •ë³´ë“¤ì„ í™•ì¸  

  (1) Data shape(í˜•íƒœ) í™•ì¸

  (2) Data type í™•ì¸

  (3) Nullê°’ í™•ì¸ (â€» ë¹ˆ ê°’ì˜ Data)

  (4) Outlier í™•ì¸ (â€» ì •ìƒì ì¸ ë²”ì£¼ë¥¼ ë²—ì–´ë‚œ Data)
"""

# â–¶ Data í˜•íƒœ í™•ì¸
# â–¶ 3,533,286 row, 9 colë¡œ êµ¬ì„±ë¨
print('df', df.shape)

# â–¶ Data type í™•ì¸
df.info()

# â–¶ Null ê°’ í™•ì¸
print(df.isnull().sum())

# â–¶ Null value ë‹¤ë¥¸ ê°’ìœ¼ë¡œ ì¹˜í™˜
df['category_code'].fillna('None', inplace = True)
df['brand'].fillna('None', inplace = True)
df['user_session'].fillna('None', inplace = True)

# â–¶ Outlier í™•ì¸
df.describe()

df = df[df['price'] >= 0]

# â–¶ object type ì´ì—ˆë˜ event_timeì˜ í˜•ì‹ ë³€ê²½
df['event_time'] = pd.to_datetime(df['event_time'])
type(df['event_time'][0])

df.info()

"""## **ğŸ”ˆProcess02**  
### Â· ë°ì´í„° EDA
---
"""

import pandas as pd
import matplotlib.pyplot as plt

# event_time ì»¬ëŸ¼ì„ datetime í˜•ì‹ìœ¼ë¡œ ë³€í™˜ (ì´ë¯¸ ë³€í™˜ë˜ì–´ ìˆì§€ ì•Šë‹¤ë©´)
df['event_time'] = pd.to_datetime(df['event_time'])

# ë‚ ì§œë³„ ì´ë²¤íŠ¸ ë°œìƒ ë¹ˆë„ ì‹œê°í™”
df['date'] = df['event_time'].dt.date


# ì‹œê°„ëŒ€ë³„ ì´ë²¤íŠ¸ ë°œìƒ ë¹ˆë„ ì‹œê°í™”
df['hour'] = df['event_time'].dt.hour

import seaborn as sns

# event_type ë³„ë¡œ ê·¸ë£¹í™”í•œ í›„ ì‹œê°„ëŒ€ë³„ ë¹ˆë„ ê³„ì‚°
hourly_event_type_count = df.groupby(['hour', 'event_type']).size().unstack()

# Seabornì˜ íŒŒìŠ¤í…” ìƒ‰ìƒ íŒ”ë ˆíŠ¸ ì‚¬ìš©
pastel_palette = sns.color_palette("pastel")

# ì‹œê°„ëŒ€ë³„ ì´ë²¤íŠ¸ íƒ€ì… ë¶„í¬ ì‹œê°í™” (íŒŒìŠ¤í…” ìƒ‰ìƒ ì ìš©)
hourly_event_type_count.plot(kind='bar', stacked=True, figsize=(12, 6), color=pastel_palette)
plt.title('Event Type By Time Range')
plt.xlabel('Time Range (0~23)')
plt.ylabel('Event Count')
plt.legend(title='event type')
plt.show()

df['price_range'] = pd.cut(df['price'], bins=[0, 1, 5, 10, 20, 50, 100, 200, 350],
                           labels=['0-1', '1-5', '5-10', '10-20', '20-50', '50-100', '100-200', '200-350'])

# ì´ìƒì¹˜ì˜ ê°œìˆ˜ ê³„ì‚° (ìƒí•œ/í•˜í•œì„ ë„˜ëŠ” ê°’)
Q1 = df['price'].quantile(0.25)
Q3 = df['price'].quantile(0.75)
IQR = Q3 - Q1

outlier_mask = (df['price'] < (Q1 - 1.5 * IQR)) | (df['price'] > (Q3 + 1.5 * IQR))
outliers = df[outlier_mask]

# ì´ë²¤íŠ¸ íƒ€ì…ë³„ ì´ìƒì¹˜ ë¹ˆë„
outliers_event_type_count = outliers['event_type'].value_counts()
print(outliers_event_type_count)

# ì´ë²¤íŠ¸ íƒ€ì…ë³„ë¡œ ì´ìƒì¹˜ ê°€ê²©ëŒ€ ë¶„ì„
sns.boxplot(x='event_type', y='price', data=outliers, palette='pastel')
plt.title('Outlier by Event Type')
plt.show()

# ì„¸ì…˜ë³„ë¡œ event_typeì„ ê·¸ë£¹í™”í•˜ì—¬ ê° ì´ë²¤íŠ¸ ë°œìƒ íšŸìˆ˜ ê³„ì‚°
session_event_counts = df.groupby(['user_session', 'event_type']).size().unstack(fill_value=0)

# í´ë¦­ì—ì„œ ì¥ë°”êµ¬ë‹ˆ ì¶”ê°€ë¡œ, ì¥ë°”êµ¬ë‹ˆ ì¶”ê°€ì—ì„œ êµ¬ë§¤ë¡œ ì´ì–´ì§€ëŠ” ì „í™˜ìœ¨ ê³„ì‚°
session_event_counts['view_to_cart'] = session_event_counts['cart'] / session_event_counts['view']
session_event_counts['cart_to_purchase'] = session_event_counts['purchase'] / session_event_counts['cart']

# ì „í™˜ìœ¨ì´ 0ì¸ ê°’ì€ ì œê±°
session_event_counts.replace([float('inf'), 0], 0, inplace=True)

# í‰ê·  ì „í™˜ìœ¨ ê³„ì‚°
click_to_cart_rate = session_event_counts['view_to_cart'].mean()
cart_to_purchase_rate = session_event_counts['cart_to_purchase'].mean()

# ì „í™˜ìœ¨ ì‹œê°í™”
labels = ['view â†’ cart', 'cart â†’ purchase']
conversion_rates = [click_to_cart_rate, cart_to_purchase_rate]

plt.figure(figsize=(8, 6))
plt.bar(labels, conversion_rates, color = pastel_palette)
plt.title('User session conv')
plt.ylabel('conversion')
plt.ylim(0, 1)
plt.show()

"""## **ğŸ”ˆProcess03**   
### Â· í¼ë„ë¶„ì„
---

#### í¼ë„ë¶„ì„ì„ ìœ„í•´ ìƒì„±í•´ì•¼ í•˜ëŠ” ì§€í‘œ

- dropout : ì´ë²¤íŠ¸ íƒ€ì…ì—ì„œ íƒ€ì…ìœ¼ë¡œ ë„˜ì–´ê°ˆ ë•Œì˜ ì´íƒˆë¥ ì„ ì˜ë¯¸
- funnel stages : ì„¤ê³„ëœ ìœ ì €ê²½í—˜ ë£¨íŠ¸
ë³¸ ë³´ê³ ì„œì—ì„œëŠ” view - cart - purchaseì˜ ìˆœì„œë¡œ ì„¤ê³„í•˜ì˜€ë‹¤.
"""

# â–¶ ì´ë²¤íŠ¸ íƒ€ì… íšŸìˆ˜
# â–¶ ê° ì´ë²¤íŠ¸ê°€ ë°œìƒí•œ íšŸìˆ˜ë¥¼ count

event_counts = df['event_type'].value_counts()
event_counts

# â–¶ ê° ë‹¨ê³„ì—ì„œì˜ ì´íƒˆë¥  ê³„ì‚°

view_to_cart_dropout = (event_counts['view'] - event_counts['cart']) / event_counts['view'] * 100
cart_to_purchase_dropout = (event_counts['cart'] - event_counts['purchase']) / event_counts['cart'] * 100
cart_to_remove_dropout = (event_counts['remove_from_cart']) / event_counts['cart'] * 100

dropout_rates = {
    'View to Cart Dropout Rate (%)': view_to_cart_dropout,
    'Cart to Purchase Dropout Rate (%)': cart_to_purchase_dropout,
    'Cart to Remove Dropout Rate (%)': cart_to_remove_dropout
}

dropout_rates

# â–¶ ìƒí’ˆë³„ ì¡°íšŒ, ì¥ë°”êµ¬ë‹ˆ ì¶”ê°€, êµ¬ë§¤ ë°ì´í„° ê³„ì‚°
product_events = df.groupby(['product_id', 'event_type']).size().unstack().fillna(0)

# â–¶ êµ¬ë§¤ ì „í™˜ë¥  ê³„ì‚°: êµ¬ë§¤ìˆ˜ / ì¡°íšŒìˆ˜
product_events['conversion_rate'] = product_events['purchase'] / product_events['view'] * 100

# â–¶ ìƒí’ˆë³„ ì¡°íšŒìˆ˜ê°€ 10íšŒ ì´ìƒì¸ ìƒí’ˆë“¤ë§Œ í•„í„°ë§í•˜ì—¬ ì „í™˜ë¥  TOP 10 í™•ì¸
top_conversion_products = product_events[product_events['view'] >= 10].sort_values(by=['view', 'conversion_rate'], ascending=[False, True]).head(10)

top_conversion_products[['view', 'cart', 'purchase', 'conversion_rate']]

# â–¶ ê° ì´ë²¤íŠ¸ íƒ€ì…ë³„, ìœ ì €ë³„ ìµœì´ˆ ì ‘ì† ì‹œê¸° êµ¬í•˜ê¸°
# â–¶ ì‹œê°„ì— ëŒ€í•´ ìµœì´ˆ ì ‘ì†ì„ ê¸°ì¤€ìœ¼ë¡œ í•˜ê¸°ìœ„í•´ min ì‚¬ìš©

grouped = df.groupby(['event_type', 'user_session'])['event_time'].min()
grouped.head()

# â–¶ funnel_stages ì •ì˜ í›„ dataframeí™”
funnel_stages = pd.DataFrame({'stages' : [1,2,3]}, index = ['view', 'cart', 'purchase'])
funnel_stages

# â–¶ ì´ë²¤íŠ¸ íƒ€ì…ì„ ê¸°ì¤€ìœ¼ë¡œ funnel stagesì™€ typeë³„ ìœ ì ¸, ìµœì´ˆ ì ‘ì† ì‹œê°„ merge

grouped = pd.DataFrame(grouped).merge(funnel_stages, left_on = 'event_type', right_index=True)
grouped

# â–¶í”¼ë²—í…Œì´ë¸” ìƒì„±

funnel = grouped.reset_index().pivot(index = 'user_session', columns = 'stages', values = 'event_time')
funnel.columns = funnel_stages.index
funnel

# â–¶ ê° stageì˜ ê°œìˆ˜ count
stage_values = [funnel[column].notnull().sum() for column in funnel.columns]
stage_values

# â–¶ funnel ì‹œê°í™”
import plotly.express as px
data = dict (
  number = [794417, 165296, 28894],
  stage = ['View', 'Cart', 'Purchase'])
fig = px.funnel(data, x='number', y='stage')
fig.show()

"""---"""

import plotly.express as px

# ì‹œê°„ëŒ€ë¥¼ ì¶”ì¶œí•˜ì—¬ ìƒˆë¡œìš´ ì—´ ì¶”ê°€
df['hour'] = df['event_time'].dt.hour


# ì‹œê°„ëŒ€ ë²”ì£¼ í†µí•© (ì˜ˆ: 0~5ì‹œ, 6~11ì‹œ, 12~17ì‹œ, 18~23ì‹œ)
bins = [0, 6, 12, 18, 24]
labels = ['0-6ì‹œ', '6-12ì‹œ', '12-18ì‹œ', '18-24ì‹œ']
df['hour_group'] = pd.cut(df['hour'], bins=bins, labels=labels, right=False)

# ì‹œê°„ëŒ€ ê·¸ë£¹ë³„ ì´ë²¤íŠ¸ ë°œìƒ íšŸìˆ˜ ì§‘ê³„
time_funnel_data = df.groupby(['hour_group', 'event_type']).size().unstack(fill_value=0)

# ì‹œê°í™”ë¥¼ ìœ„í•œ ë°ì´í„° ì¤€ë¹„
funnel_data = pd.DataFrame({
    'hour_group': time_funnel_data.index,
    'View': time_funnel_data['view'],
    'Cart': time_funnel_data['cart'],
    'Purchase': time_funnel_data['purchase']
})


# ë°ì´í„°ë¥¼ meltí•˜ì—¬ ì‹œê°í™”ì— ì í•©í•œ í˜•íƒœë¡œ ë³€í™˜
funnel_data_melted = pd.melt(funnel_data, id_vars=['hour_group'], value_vars=['View', 'Cart', 'Purchase'], var_name='stage', value_name='number')
# Funnel ì°¨íŠ¸ ì‹œê°í™”
fig = px.funnel(funnel_data_melted, x='number', y='stage', color='hour_group', title="ì‹œê°„ëŒ€ ê·¸ë£¹ë³„ ì „í™˜ Funnel ë¶„ì„")
fig.show()

# ê°€ê²©ëŒ€ êµ¬ê°„ ì„¤ì • (ì˜ˆ: 0-50, 50-100, 100-200, 200-350)
bins = [0, 50, 100, 200, 350]
labels = ['0-50', '50-100', '100-200', '200-350']
df['price_range'] = pd.cut(df['price'], bins=bins, labels=labels)

# ê°€ê²©ëŒ€ë³„ ì´ë²¤íŠ¸ ë°œìƒ íšŸìˆ˜ ì§‘ê³„
price_funnel_data = df.groupby(['price_range', 'event_type']).size().unstack(fill_value=0)

# ì‹œê°í™”ë¥¼ ìœ„í•œ Funnel ë°ì´í„° ì¤€ë¹„
funnel_data = pd.DataFrame({
    'price_range': price_funnel_data.index,
    'View': price_funnel_data['view'],
    'Cart': price_funnel_data['cart'],
    'Purchase': price_funnel_data['purchase']
})

# ê° ê°€ê²©ëŒ€ë³„ ë°ì´í„°ê°€ ë™ì¼í•œ ê¸¸ì´ë¥¼ ìœ ì§€í•¨ì„ ë³´ì¥
funnel_data_melted = pd.melt(funnel_data, id_vars=['price_range'], value_vars=['View', 'Cart', 'Purchase'], var_name='stage', value_name='number')

# Funnel ì°¨íŠ¸ ì‹œê°í™”
fig = px.funnel(funnel_data_melted, x='number', y='stage', color='price_range', title="ê°€ê²©ëŒ€ë³„ ì „í™˜ Funnel ë¶„ì„")
fig.show()

"""---"""

# ì‹œê°„ëŒ€ì™€ ê°€ê²©ëŒ€ ì„¤ì •
bins_hour = [0, 6, 12, 18, 24]
labels_hour = ['0-6ì‹œ', '6-12ì‹œ', '12-18ì‹œ', '18-24ì‹œ']
df['hour_group'] = pd.cut(df['hour'], bins=bins_hour, labels=labels_hour, right=False)

bins_price = [0, 50, 100, 200, 350]
labels_price = ['0-50', '50-100', '100-200', '200-350']
df['price_range'] = pd.cut(df['price'], bins=bins_price, labels=labels_price)

# ì´ë²¤íŠ¸ë³„ë¡œ ê·¸ë£¹í™”í•˜ì—¬ í¬ê¸° ì§‘ê³„
grouped_price_time = df.groupby(['price_range', 'hour_group', 'event_type']).size().unstack(fill_value=0).reset_index()

# ê²°ê³¼ í™•ì¸
print(grouped_price_time.head())

# price_range ë° hour_group ì—´ì„ objectë¡œ ë³€í™˜
grouped_price_time['price_range'] = grouped_price_time['price_range'].astype('object')
grouped_price_time['hour_group'] = grouped_price_time['hour_group'].astype('object')

# ê¸°ì¡´ ì „í™˜ìœ¨ ê³„ì‚° (ê°€ê²©ëŒ€ ë° ì‹œê°„ëŒ€ë³„)
grouped_price_time['view_to_cart_rate'] = grouped_price_time['cart'] / grouped_price_time['view']
grouped_price_time['cart_to_purchase_rate'] = grouped_price_time['purchase'] / grouped_price_time['cart']

# NaN ê°’ì„ 0ìœ¼ë¡œ ì±„ìš°ê¸° (ì „í™˜ìœ¨ì´ ì—†ëŠ” ê²½ìš°)
grouped_price_time.fillna(0, inplace=True)

# ê¸°ì¡´ ì „í™˜ìœ¨ ì¶œë ¥
grouped_price_time[['price_range', 'hour_group', 'view_to_cart_rate', 'cart_to_purchase_rate']]

# ì „ëµ ë„ì… í›„ ì „í™˜ìœ¨ ê°€ì • (ì˜ˆì‹œë¡œ ê¸°ì¡´ ì „í™˜ìœ¨ì—ì„œ 10% ì¦ê°€ ê°€ì •)
grouped_price_time['new_view_to_cart_rate'] = grouped_price_time['view_to_cart_rate'] + 0.10  # 10% ì¦ê°€ ê°€ì •
grouped_price_time['new_cart_to_purchase_rate'] = grouped_price_time['cart_to_purchase_rate'] + 0.05  # 5% ì¦ê°€ ê°€ì •

# ê° ê°€ê²©ëŒ€/ì‹œê°„ëŒ€ë³„ ë§¤ì¶œ ê³„ì‚° (ê¸°ì¡´ ë° ì „ëµ ë„ì… í›„)
average_purchase_value = 80  # í‰ê·  êµ¬ë§¤ ê¸ˆì•¡ ê°€ì •

# ê¸°ì¡´ ë§¤ì¶œ ê³„ì‚°
grouped_price_time['original_sales'] = grouped_price_time['purchase'] * average_purchase_value

# ì „ëµ ë„ì… í›„ ë§¤ì¶œ ê³„ì‚° (ê°€ì •ëœ ì „í™˜ìœ¨ì„ ì ìš©í•œ ë§¤ì¶œ)
grouped_price_time['new_cart'] = grouped_price_time['view'] * grouped_price_time['new_view_to_cart_rate']
grouped_price_time['new_purchase'] = grouped_price_time['new_cart'] * grouped_price_time['new_cart_to_purchase_rate']
grouped_price_time['new_sales'] = grouped_price_time['new_purchase'] * average_purchase_value

# ê²°ê³¼ í™•ì¸
grouped_price_time[['price_range', 'hour_group', 'original_sales', 'new_sales']]

import matplotlib.pyplot as plt

# ê°€ê²©ëŒ€ë³„ë¡œ ê¸°ì¡´ ë§¤ì¶œê³¼ ìƒˆë¡œìš´ ë§¤ì¶œì„ ë¹„êµ
price_categories = grouped_price_time['price_range'].unique()

# ê¸°ì¡´ ë§¤ì¶œê³¼ ìƒˆë¡œìš´ ë§¤ì¶œì˜ í•©ê³„ ê³„ì‚°
original_sales = grouped_price_time.groupby('price_range')['original_sales'].sum()
new_sales = grouped_price_time.groupby('price_range')['new_sales'].sum()

import matplotlib.pyplot as plt

# ê°€ê²©ëŒ€ë³„ë¡œ ê¸°ì¡´ ë§¤ì¶œê³¼ ìƒˆë¡œìš´ ë§¤ì¶œì˜ í•©ê³„ ê³„ì‚°
grouped_by_price = grouped_price_time.groupby('price_range').agg({
    'original_sales': 'sum',
    'new_sales': 'sum'
}).reset_index()

# ê°€ê²©ëŒ€ 50-100ë§Œ í•„í„°ë§
filtered_price = grouped_by_price[grouped_by_price['price_range'] == '50-100']

# ê¸°ì¡´ ë§¤ì¶œê³¼ ìƒˆë¡œìš´ ë§¤ì¶œ
original_sales_price = filtered_price['original_sales']
new_sales_price = filtered_price['new_sales']
categories_price = filtered_price['price_range']

# ì‹œê°í™”
fig, ax = plt.subplots(figsize=(6, 4))
bar_width = 0.35
index = range(len(categories_price))

# ë§‰ëŒ€ ê·¸ë˜í”„ ê·¸ë¦¬ê¸°
bar1 = plt.bar(index, original_sales_price, bar_width, label='Original Sales_price', color='#ADD8E6')  # í•˜ëŠ˜ìƒ‰
bar2 = plt.bar([i + bar_width for i in index], new_sales_price, bar_width, label='New_Sales_price', color='#FFB6C1')  # í•‘í¬ìƒ‰

plt.xlabel('Price Range')
plt.ylabel('Sales')
plt.title('50-100 Sales Differences')
plt.xticks([i + bar_width / 2 for i in index], categories_price)
plt.legend()


# ë§‰ëŒ€ ìœ„ì— ë§¤ì¶œ ê°’ í‘œì‹œ
for i, v in enumerate(original_sales_price):
    plt.text(i - 0.1, v + 1000, f"${v:.0f}", color='#4682B4', fontweight='bold')  # í•˜ëŠ˜ìƒ‰ í…ìŠ¤íŠ¸
for i, v in enumerate(new_sales_price):
    plt.text(i + bar_width - 0.1, v + 1000, f"${v:.0f}", color='#FF69B4', fontweight='bold')  # í•‘í¬ í…ìŠ¤íŠ¸


plt.show()

# ì‹œê°„ëŒ€ë³„ë¡œ ê¸°ì¡´ ë§¤ì¶œê³¼ ìƒˆë¡œìš´ ë§¤ì¶œì˜ í•©ê³„ ê³„ì‚°

grouped_by_time = grouped_price_time.groupby('hour_group').agg({
    'original_sales': 'sum',
    'new_sales': 'sum'
}).reset_index()

# ì‹œê°„ëŒ€ 6-12ì‹œ ë° 12-18ì‹œë§Œ í•„í„°ë§
filtered_time = grouped_by_time[grouped_by_time['hour_group'].isin(['6-12ì‹œ', '12-18ì‹œ'])]

# ê¸°ì¡´ ë§¤ì¶œê³¼ ìƒˆë¡œìš´ ë§¤ì¶œ
original_sales_time = filtered_time['original_sales']
new_sales_time = filtered_time['new_sales']
categories_time = filtered_time['hour_group']

# ì‹œê°í™”
fig, ax = plt.subplots(figsize=(8, 5))
bar_width = 0.35
index = range(len(categories_time))

# ë§‰ëŒ€ ê·¸ë˜í”„ ê·¸ë¦¬ê¸°
bar1 = plt.bar(index, original_sales_time, bar_width, label='Original_Sales_time', color='#ADD8E6')  # í•˜ëŠ˜ìƒ‰
bar2 = plt.bar([i + bar_width for i in index], new_sales_time, bar_width, label='New_Sales_time', color='#FFB6C1')  # í•‘í¬ìƒ‰

plt.xlabel('Time Range')
plt.ylabel('Sales')
plt.title('6-12 / 12-18 Sales Difference')
plt.xticks([i + bar_width / 2 for i in index], categories_time)
plt.legend()

# ë§‰ëŒ€ ìœ„ì— ë§¤ì¶œ ê°’ í‘œì‹œ
for i, v in enumerate(original_sales_time):
    plt.text(i - 0.1, v + 1000, f"${v:.0f}", color='#4682B4', fontweight='bold')  # í•˜ëŠ˜ìƒ‰ í…ìŠ¤íŠ¸
for i, v in enumerate(new_sales_time):
    plt.text(i + bar_width - 0.1, v + 1000, f"${v:.0f}", color='#FF69B4', fontweight='bold')  # í•‘í¬ í…ìŠ¤íŠ¸


plt.show()

"""---"""